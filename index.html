<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="initial-scale=1">
	<title>Score</title>
</head>
<body>
	<style>
		input{
			padding: 20px;
			font-size: 2em;
			width: 150px;
		}	
		span{
			margin-left: 20px;
			font-size: 2em;
		}
		h4{
			font-size: 2em;
			display: inline-block;
		}
		h5{
			display: inline-block;
			width: 150px;
			margin-left: 20px;
		}
		@media (max-width: 500px) {
			h5{
				display: block;
				font-size: 28px;
			}
			h4{
				font-size: 1em;
			}
		}
		h1, h3{
			margin-left: 20px;
		}
		button {
			position: absolute;
			right: 10px;
			top: 10px;
		}
		#result-wrapper{
			margin-top: 40px;
		}

	</style>
	
	<h1>Служебное двоеборье</h1>
	<button id="popup">
		<h2>Цель</h2>
	</button>
	<h3>Введите результаты забега и узнайте свои очки!</h3>
	<h3>Чтобы изменить вид спорта, кликнуть по названию</h3>
	<label for="">
		<h5>Время:</h5> 
		<input type="time" id="time">
	</label>
	<span id="time_score"></span>
	<br />
	<label for="">
		<h5>Стрельба:</h5>
		<input type="number" min="0" max="100" id="shoot">
	</label>
	<span id="shoot_score"></span>
	<br />
	<div id="result-wrapper">
		<h4>
			Общий результат: 
		</h4>
		<span id="result"></span>
		<br />
		<h4>
			Выполнена норма:
		</h4>
		<span id="norm"></span>
	</div>
	<div class="temp">Средний темп бега на 1км, при условии общего времени стрельбы 50с: <span id="temp"></span></div>

	<script>
		var targetExist = false;
		var targetScore = 0;

		var manRun1 = {
			"845": 1735,
			"846": 1727, 
			"847": 1719, 
			"848": 1711, 
			"849": 1703, 
			"850": 1695, 
			"851": 1687, 
			"852": 1679, 
			"853": 1671, 
			"854": 1663, 
			"855": 1655, 
			"856": 1647, 
			"857": 1639, 
			"858": 1631, 
			"859": 1623, 
			"900": 1615, 
			"901": 1607, 
			"902": 1599, 
			"903": 1591, 
			"904": 1583, 
			"905": 1575, 
			"906": 1567, 
			"907": 1559, 
			"908": 1551, 
			"909": 1543, 
			"910": 1535, 
			"911": 1527, 
			"912": 1519, 
			"913": 1511, 
			"914": 1503, 
			"915": 1495, 
			"916": 1487, 
			"917": 1479, 
			"918": 1471, 
			"919": 1463, 
			"920": 1455,	
			"921": 1447,	
			"922": 1439,	
			"923": 1431,	
			"924": 1423,	
			"925": 1415,	
			"926": 1407,	
			"927": 1399,	
			"928": 1391,	
			"929": 1383,	
			"930": 1375,	
			"931": 1362,	
			"932": 1349,	
			"933": 1336,	
			"934": 1323,	
			"935": 1310,	
			"936": 1298,	
			"937": 1286,	
			"938": 1274,	
			"939": 1262,	
			"940": 1250,	
			"941": 1238,	
			"942": 1226,	
			"943": 1214,	
			"944": 1202,	
			"945": 1191,	
			"946": 1180,	
			"947": 1169,	
			"948": 1158,	
			"949": 1147,	
			"950": 1137,	
			"951": 1127,	
			"952": 1117,	
			"953": 1107, 	
			"954": 1097,	
			"955": 1087,	
			"956": 1077,	
			"957": 1068,	
			"958": 1059,	
			"959": 1050,   
			"1000": 1041,	
			"1001": 1032,	
			"1002": 1023,	
			"1003": 1014,	
			"1004": 1005,	
			"1005": 996,	
			"1006": 987,	
			"1007": 979,	
			"1008": 971,	
			"1009": 963,	
			"1010": 955,	
			"1011": 947,	
			"1012": 939, 
			"1013": 931, 
			"1014": 923, 
			"1015": 915, 
			"1016": 907, 
			"1017": 899,	
			"1018": 891,	
			"1019": 883, 
			"1020": 875, 
			"1021": 868, 
			"1022": 861, 
			"1023": 854, 
			"1024": 847, 
			"1025": 840, 
			"1026": 833, 
			"1027": 826, 
			"1028": 819,	
			"1029": 812,	
			"1030": 805,	
			"1031": 798,	
			"1032": 791, 
			"1033": 784, 
			"1034": 777, 
			"1035": 770, 
			"1036": 763, 
			"1037": 756, 
			"1038": 749,	
			"1039": 742,	
			"1040": 736,	
			"1041": 730,	
			"1042": 724,	
			"1043": 718,	
			"1044": 712,	
			"1045": 706,	
			"1046": 700,	
			"1047": 694,	
			"1048": 688,	
			"1049": 682,	
			"1050": 676,	
			"1051": 670,	
			"1052": 664,	
			"1053": 658,	
			"1054": 652,	
			"1055": 646,	
			"1056": 640,	
			"1057": 634,	
			"1058": 628,	
			"1059": 622, 
			"1100": 616, 
			"1101": 610, 
			"1102": 604, 
			"1103": 598, 
			"1104": 592,	
			"1105": 587,	
			"1106": 582, 
			"1107": 577, 
			"1108": 572, 
			"1109": 567, 
			"1110": 562, 
			"1111": 557, 
			"1112": 552, 
			"1113": 547, 
			"1114": 542, 
			"1115": 537,	
			"1116": 532,	
			"1117": 527,	
			"1118": 522,	
			"1119": 517, 
			"1120": 512, 
			"1121": 507, 
			"1122": 502, 
			"1123": 497, 
			"1124": 492, 
			"1125": 487,	
			"1126": 482,	
			"1127": 477,	
			"1128": 472,	
			"1129": 467,	
			"1130": 462,	
			"1131": 457,	
			"1132": 452,	
			"1133": 447,	
			"1134": 442,	
			"1135": 437,	
			"1136": 432,	
			"1137": 428,	
			"1138": 424,	
			"1139": 420,	
			"1140": 416,	
			"1141": 412,	
			"1142": 408,	
			"1143": 404,	
			"1144": 400,	
			"1145": 396,	
			"1146": 392,	
			"1147": 388,	
			"1148": 384,	
			"1149": 380,	
			"1150": 376,	
			"1151": 372,	
			"1152": 368,	
			"1153": 364,	
			"1154": 360,	
			"1155": 356,	
			"1156": 352,	
			"1157": 348,	
			"1158": 344,	
			"1159": 340,	
			"1200": 336,	
			"1201": 332,	
			"1202": 328,	
			"1203": 324,	
			"1204": 320,	
			"1205": 316,	
			"1206": 312,	
			"1207": 308,	
			"1208": 304,	
			"1209": 300,	
			"1210": 296,	
			"1211": 292,	
			"1212": 288,	
			"1213": 284,	
			"1214": 280,	
			"1215": 276,	
			"1216": 272,
			"1217": 269,
			"1218": 266,
			"1219": 263,
			"1220": 260,
			"1221": 257,
			"1222": 254,
			"1223": 251,
			"1224": 248,
			"1225": 245,
			"1226": 242,
			"1227": 239,
			"1228": 236,
			"1229": 233,
			"1230": 230,
			"1231": 227,
			"1232": 224,
			"1233": 221,
			"1234": 218,
			"1235": 215,
			"1236": 212,
			"1237": 209,
			"1238": 206,
			"1239": 203,
			"1240": 200,
			"1241": 197,
			"1242": 194,
			"1243": 191,
			"1244": 188,
			"1245": 185,
			"1246": 182,
			"1247": 179,
			"1248": 176,
			"1249": 173,
			"1250": 170,
			"1251": 167,
			"1252": 164,
			"1253": 161,
			"1254": 158,
			"1255": 155,
			"1256": 152,
			"1257": 149,
			"1258": 146,
			"1259": 143,
			"1300": 140,
			"1301": 137,
			"1302": 134,
			"1303": 131,	
			"1304": 128,	
			"1305": 125,	
			"1306": 123,	
			"1307": 121,	
			"1308": 119,	
			"1309": 117,	
			"1310": 115,	
			"1311": 113,	
			"1312": 111,	
			"1313": 109,	
			"1314": 107,	
			"1315": 105,	
			"1316": 103,	
			"1317": 101,	
			"1318": 99,	
			"1319": 97,	
			"1320": 95,	
			"1321": 93,	
			"1322": 91,	
			"1323": 89,	
			"1324": 87,	
			"1325": 85,	
			"1326": 83,	
			"1327": 81,	
			"1328": 79,	
			"1329": 77,	
			"1330": 75,	
			"1331": 73,	
			"1332": 71,	
			"1333": 69,	
			"1334": 67,	
			"1335": 65,	
			"1336": 63,	
			"1337": 61,
			"1338": 59,
			"1339": 57,
			"1340": 55,
			"1341": 53,
			"1342": 51,
			"1343": 49,
			"1344": 47,
			"1345": 45,
			"1346": 43,
			"1347": 41,
			"1348": 39,
			"1349": 37,
			"1350": 35,
			"1351": 33,
			"1352": 31,
			"1353": 29,
			"1354": 27,
			"1355": 25,
			"1356": 23,
			"1357": 21,
			"1358": 19,
			"1359": 17,
			"1400": 15,
			"1401": 13,
			"1402": 11,
			"1403": 9,
			"1404": 7,
			"1405": 5,
			"1406": 4,
			"1407": 3,
			"1408": 2,
			"1409": 1,
			"1410": 0};
		var manShoot1 = {
			"100": 1375, 
			"76": 835,	
			"52": 368,	
			"99": 1350, 
			"75": 815,
			"51": 349,	
			"98": 1325, 
			"74": 795,
			"50": 330,	
			"97": 1300, 
			"73": 775,
			"49": 311,	
			"96": 1275,
			"72": 755,
			"48": 292,
			"95": 1250,
			"71": 735,
			"47": 274,
			"94": 1226,
			"70": 715,
			"46": 256,
			"93": 1202,
			"69": 695,
			"45": 238,
			"92": 1179,
			"68": 675,
			"44": 220,
			"91": 1156,
			"67": 655,
			"43": 202,
			"90": 1133,
			"66": 635,
			"42": 184,
			"89": 1111,
			"65": 615,
			"41": 166,
			"88": 1089,
			"64": 596,
			"40": 148,
			"87": 1067,
			"63": 577,
			"39": 130,
			"86": 1045,
			"62": 558,
			"38": 112,
			"85": 1023,
			"61": 539,
			"84": 1002,
			"37": 94, 
			"36": 76, 
			"35": 58, 
			"83": 981,
			"59": 501,
			"60": 520,
			"82": 960,
			"58": 482,
			"34": 40,
			"81": 939,
			"57": 463,
			"33": 22,
			"80": 918,
			"56": 444,
			"32": 4,
			"79": 897,
			"55": 425,
			"31": 0,	
			"78": 876,
			"54": 406,
			"77": 855,
			"53": 387};

		function reverse(obj) {
			let res = {}
			for(var key in obj){
				res[obj[key]] = key;
			}
			return  res
		}

		function extractValue(obj, value){
			if(obj[value] !== undefined){
				return obj[value]
			} else {
				return extractValue(obj, value + 1)
			}
		}

		var manRun2 = {
			"905":	1250,	
			"949":	820,	
			"1033":488,	
			"1117":	263,	
			"1201":	138,	
			"1245":50,	
			"906":	1240,	
			"950":	812,	
			"1034":	482,	
			"1118":	260,	
			"1202":	136,	
			"1246":48,	
			"907":	1230,	
			"951":	804,	
			"1035":	476,	
			"1119":	257,	
			"1203":	134,	
			"1247":46,	
			"908":	1220,	
			"952":	796,	
			"1036":	470,	
			"1120":	254,	
			"1204":	132,	
			"1248":44,	
			"909":	1210,	
			"953":	788,	
			"1037":	464,	
			"1121":	251,	
			"1205":	130,	
			"1249":42,	
			"910":	1200,	
			"954":	780,	
			"1038":	458,	
			"1122":	249,	
			"1206":	128,	
			"1250":40,	
			"911":	1190,	
			"955":	772,	
			"1039":	452,	
			"1123":	246,	
			"1207":	126,	
			"1251":38,	
			"912":	1180,	
			"956":	764,	
			"1040":	446,	
			"1124":	243,	
			"1208":	124,	
			"1252":36,	
			"913":	1170,	
			"957":	756,	
			"1041":	440,	
			"1125":	240,	
			"1209":	122,	
			"1253":35,	
			"914":	1160,	
			"958":	748,	
			"1042":	434,	
			"1126":	237,	
			"1210":	120,	
			"1254":34,	
			"915":	1150,	
			"959":	740,	
			"1043":	428,	
			"1127":	233,	
			"1211":	118,	
			"1255":33,	
			"916":	1140,	
			"1000":732,	
			"1044":422,
			"1128":230,
			"1212":116,
			"1256":32,
			"917":	1130,	
			"1001":724,	
			"1045":416,
			"1129":227,
			"1213":114,
			"1257":31,
			"918":	1120,	
			"1002":716,	
			"1046":410,
			"1130":224,
			"1214":112,
			"1258":30,
			"919":	1110,	
			"1003":708,	
			"1047":404,
			"1131":221,
			"1215":110,
			"1259":29,
			"920":	1100,	
			"1004":700,	
			"1048":398,
			"1132":219,
			"1216":108,
			"1300":28,
			"921":	1090,	
			"1005":692,	
			"1049":392,
			"1133":216,
			"1217":106,
			"1301":27,
			"922":	1080,	
			"1006":	684,	
			"1050":	386,	
			"1134":	213,	
			"1218":	104,	
			"1302":26,	
			"923":	1070,	
			"1007":	676,	
			"1051":	380,	
			"1135":	210,	
			"1219":	102,	
			"1303":25,	
			"924":	1060,	
			"1008":	668,	
			"1052":	374,	
			"1136":	207,	
			"1220":	100,	
			"1304":24,	
			"925":	1050,	
			"1009":	660,	
			"1053":	368,	
			"1137":	204,	
			"1221":	98,	
			"1305":23,	
			"926":	1040,	
			"1010":	652,	
			"1054":	362,	
			"1138":	201,	
			"1222":	96,	
			"1306":22,	
			"927":	1030,	
			"1011":	644,	
			"1055":	356,	
			"1139":	198,	
			"1223":	94,	
			"1307":21,	
			"928":	1020,	
			"1012":	636,	
			"1056":	350,	
			"1140":	195,	
			"1224":	92,	
			"1308":20,	
			"929":	1010,	
			"1013":	628,	
			"1057":	345,	
			"1141":	192,	
			"1225":	90,	
			"1309":19,	
			"930":	1000,	
			"1014":	620,	
			"1058":	340,	
			"1142":	189,	
			"1226":	88,	
			"1310":18,	
			"931":	990,	
			"1015":	612,	
			"1059":	335,	
			"1143":	186,	
			"1227":	86,	
			"1311":17,	
			"932":	980,	
			"1016":	604,	
			"1100":	330,	
			"1144":	183,	
			"1228":	84,	
			"1312":16,	
			"933":	970,	
			"1017":	596,	
			"1101":	325,	
			"1145":	180,	
			"1229":	82,	
			"1313":15,	
			"934":	960,	
			"1018":	589,	
			"1102":	320,	
			"1146":	177,	
			"1230":	80,	
			"1314":14,	
			"935":	950,	
			"1019":	582,	
			"1103":	315,	
			"1147":	174,	
			"1231":	78,	
			"1315":13,	
			"936":	940,	
			"1020":	575,	
			"1104":	310,	
			"1148":	171,	
			"1232":	76,	
			"1316":12,	
			"937":	930,	
			"1021":	568,	
			"1105":	305,	
			"1149":	168,	
			"1233":	74,	
			"1317":11,	
			"938":	920,	
			"1022":	561,	
			"1106":	301,	
			"1150":	165,	
			"1234":	72,	
			"1318":10,	
			"939":	910,	
			"1023":	554,	
			"1107":	297,	
			"1151":	162,	
			"1235":	70,	
			"1319":9,	
			"940":	900,	
			"1024":	547,	
			"1108":	293,	
			"1152":	159,	
			"1236":	68,	
			"1320":8,	
			"941":	890,	
			"1025":	540,	
			"1109":	289,	
			"1153":	156,	
			"1237":	66,	
			"1321":7,	
			"942":	880,	
			"1026":	533,	
			"1110":	285,	
			"1154":	153,	
			"1238":	64,	
			"1322":6,	
			"943":	870,	
			"1027":	526,	
			"1111":	281,	
			"1155":	150,	
			"1239":	62,	
			"1323":5,	
			"944":	861,	
			"1028":	519,	
			"1112":	278,	
			"1156":	148,	
			"1240":	60,	
			"1324":4,	
			"945":	852,	
			"1029": 512,	
			"1113": 275,	
			"1157": 146,	
			"1241": 58	,
			"1325": 3	,
			"946":	844	,
			"1030": 506,	
			"1114": 272,	
			"1158": 144,	
			"1242": 56	,
			"1326": 2	,
			"947":	836	,
			"1031": 500,	
			"1115": 269,	
			"1159": 142,	
			"1243": 54	,
			"1327": 1	,
			"948":	828	,
			"1032": 494,	
			"1116": 266,	
			"1200": 140,	
			"1244": 52	,
			"1328":0	}
		var manShoot2 = {
			"100":	1250,	
			"83":	860,	
			"66":	520,	
			"49":185,	
			"99":	1225,
			"82":	840,	
			"65":	500,	
			"48":170,
			"98": 1200,	
			"81": 820,	
			"64": 480,	
			"47": 155,	
			"97": 1175,	
			"80": 800,	
			"63": 460,	
			"46": 140,	
			"96": 1150,	
			"79": 780,	
			"62": 440,	
			"45": 125,	
			"95": 1125,	
			"78": 760,	
			"61": 420,	
			"44": 110,	
			"94": 1100,	
			"77": 740,	
			"60": 400,	
			"43": 95,	
			"93": 1075,	
			"76": 720,	
			"59": 380,	
			"42": 80,	
			"92": 1050,	
			"75": 700,	
			"58": 360,	
			"41": 65,	
			"91": 1025,	
			"74": 680,	
			"57": 340,	
			"40": 55,	
			"90": 1000,	
			"73": 660,	
			"56": 320,	
			"39": 45,	
			"89": 980,	
			"72": 640,	
			"55": 300,	
			"38": 35,	
			"88": 960,	
			"71": 620,	
			"54": 280,	
			"37": 25,	
			"87": 940,	
			"70": 600,	
			"53": 260,	
			"36": 15,	
			"86": 920,	
			"69": 580,	
			"52": 240,	
			"35": 10,	
			"85": 900,	
			"68": 560,	
			"51": 220,	
			"34": 5,	
			"84": 880,	
			"67": 540,	
			"50": 200,	
			"33": 0,	}


		var time = document.getElementById('time');
		var shoot = document.getElementById('shoot');
		var title = document.getElementsByTagName('h1')[0];
		var target = document.getElementById('popup')

		var Set = {
			manRun: manRun1,
			manShoot: manShoot1
		}

		function toggleSet(){
			if (Set.manShoot['100'] == 1250) {
				Set.manRun = manRun1;
				Set.manShoot = manShoot1;
				title.innerHTML = "Служебное двоеборье";
			} else {
				Set.manRun = manRun2;
				Set.manShoot = manShoot2;
				title.innerHTML = "Служебный биатлон";
			}
			refreshResults();
		}

		refreshResults = () => {
		  var resTime = Set.manRun[+time.value.replace(":", "")];
		  var resShoot = Set.manShoot[shoot.value];

			
		  if (resTime == undefined) {
		  	resTime = 0;
		  }	
		  
		  if (resShoot == undefined) {
		  	resShoot = 0;
		  }

		  document.getElementById('time_score').innerHTML = resTime;
		  document.getElementById('shoot_score').innerHTML = resShoot;
		  document.getElementById('result').innerHTML = 
		  	resTime + resShoot;
		  document.getElementById('temp').innerHTML = divideTime(time.value, 3);

		  getResult();
		}

		function onShootChange(e) {
			if (!targetExist) return;
			
			let score = Set.manShoot[+e.target.value];
			let wanted = targetScore - score;
			
			let reversScore = reverse(Set.manRun)
			let newTime = ""
			try{
				newTime = extractValue(reversScore, wanted)
			} catch(e) {
				newTime = "845"
			}

			let minutes = newTime.substring(0, newTime.length - 2)
			if (minutes.length < 2) {
				minutes = "0" + minutes
			}
			
			newTime = "" 
				+ minutes
				+ ":"
				+ newTime.substring(newTime.length - 2)
			
			time.value = newTime
			refreshResults()	
		}

		function onRunChange(e) {
			if (!targetExist) return;
			
			let score = Set.manRun[+(e.target.value).replace(":", "")];
			let wanted = targetScore - score;
			
			let reversScore = reverse(Set.manShoot)
			let newShoot = 0
			try{
				newShoot = extractValue(reversScore, wanted)
			} catch(e) {
				newShoot = 100
			}

			shoot.value = newShoot
			refreshResults()	
		}

		title.addEventListener('click', (e) => {
		  toggleSet();
		});

		time.addEventListener("input", refreshResults);
		time.addEventListener("input", onRunChange);
		shoot.addEventListener("input", refreshResults);
		shoot.addEventListener("input", onShootChange);
		target.addEventListener("click", (e) => {
			if(/\<input/.test(target.innerHTML)){
				if (e.target.nodeName == "input"){
					return;
				}
			}else{
			  	target.innerHTML = "<input id='main' type='number'>"
			  	document.getElementById('main').focus();
			  	document.getElementById('main').addEventListener("blur", (e) => {
					var main = +document.getElementById('main').value;
					target.innerHTML = "<h2>Цель: " + main + "</h2>"
					targetExist = !!main;
					targetScore = main;

					if(!targetExist){
						target.innerHTML = "<h2>Цель</h2>"
					}
			  	});
			}
		});

		function getResult(){
			let run = +document.getElementById('time_score').innerHTML;
			let shoot = +document.getElementById('shoot_score').innerHTML;
			
			let norm = run + shoot;

			if((norm >= 2000) && (run >= 700) && (shoot >= 700)){
				writeResult(norm, "МC");
				return;
			}

			if((norm >= 1800) && (run >= 600) && (shoot >= 600)){
				writeResult(norm, "КМС");
				return;
			}

			if(norm >= 1600){
				writeResult(norm, "I Разряд");
				return;
			}

			if(norm >= 1400){
				writeResult(norm, "II Разряд");
				return;
			}

			if(norm >= 1200){
				writeResult(norm, "III Разряд");
				return;
			}

			writeResult(norm, "none");
		}

		function divideTime(timeString, count){
			timeString = timeString.replace(":", "");

			let minutes = +timeString.substring(0, timeString.length - 2);
			let seconds = +timeString.substring(timeString.length - 2);

			let allSeconds = minutes * 60 + seconds;
			let partTime = (allSeconds - 50) / count | 0
			
			seconds = partTime % 60
			minutes = (partTime - seconds) / 60

			return minutes + "м " + seconds + "с"

		}
		
		function writeResult(res, norm){
			document.getElementById('result').innerHTML = res;
			document.getElementById('norm').innerHTML = norm;
		}

		// document.getElementById('popup').click()
		
	</script>
	<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(54296469, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/54296469" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</body>
</html>